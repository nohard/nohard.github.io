<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>My Code Repository</title>
    <style>
      /* 样式表用于美化目录树 */
      ul {
        list-style-type: none;
        margin: 0;
        padding: 0;
      }
      li {
        margin-left: 1em;
      }
      li:before {
        content: "▸";
        margin-right: 0.5em;
      }
    </style>
  </head>
  <body>
    <h1>My Code Repository</h1>
    <div id="container"></div>
    <script>
      // 获取code目录下的文件列表
      fetch('./code/')
        .then(response => response.text())
        .then(text => {
          // 将HTML转换为DOM元素
          const parser = new DOMParser();
          const html = parser.parseFromString(text, 'text/html');
          // 获取文件列表
          const files = Array.from(html.querySelectorAll('a'))
            .map(a => a.href.replace(window.location.href, ''));
          // 创建目录结构
          const tree = buildTree(files);
          // 在页面中显示目录结构
          const container = document.getElementById('container');
          container.appendChild(renderTree(tree));
        });

      // 创建目录树
      function buildTree(files) {
        const tree = {};
        for (const file of files) {
          const parts = file.split('/');
          let node = tree;
          for (const part of parts) {
            node[part] = node[part] || {};
            node = node[part];
          }
          node.file = file;
        }
        return tree;
      }

      // 渲染目录树为HTML元素
      function renderTree(tree) {
        const ul = document.createElement('ul');
        for (const [name, child] of Object.entries(tree)) {
          const li = document.createElement('li');
          if (child.file) {
            const a = document.createElement('a');
            a.href = '#';
            a.textContent = name;
            a.onclick = () => loadFile(child.file);
            li.appendChild(a);
          } else {
            li.textContent = name;
            li.appendChild(renderTree(child));
          }
          ul.appendChild(li);
        }
        return ul;
      }

      // 加载文件并在页面中显示
      function loadFile(file) {
        fetch(file)
          .then(response => response.text())
          .then(text => {
            const container = document.getElementById('container');
            container.innerHTML = '';
            const pre = document.createElement('pre');
            pre.textContent = text;
            container.appendChild(pre);
          });
      }
    </script>
  </body>
</html>
